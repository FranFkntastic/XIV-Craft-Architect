@using FFXIVCraftArchitect.Core.Models

@* Full-width card for split-world procurement items *@
<div style="background: @(IsSelected ? "#3a2a25" : "#2a2015"); border-radius: 4px; border: 2px solid @(IsSelected ? "#ff9800" : "#5a3a2a"); overflow: hidden;">
    
    @* Header with item info *@
    <div style="display: flex; align-items: center; padding: 4px 8px; background: @(IsSelected ? "#4a3a35" : "#3a2a25"); border-bottom: 1px solid #5a3a2a;">
        <MudIcon Icon="@Icons.Material.Filled.CallSplit" Style="color: #ff9800; margin-right: 6px;" Size="Size.Small" />
        
        <div style="flex: 1; min-width: 0; overflow: hidden;">
            <MudText Typo="Typo.body2" Style="color: #fff; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                @Item.Name
            </MudText>
        </div>
        
        <MudText Typo="Typo.caption" Style="color: #d4a73a; margin: 0 8px;">
            ×@(Item.QuantityNeeded)
        </MudText>
        
        <MudText Typo="Typo.body2" Style="color: #ff9800; font-weight: 700; min-width: 70px; text-align: right;">
            @(ShoppingPlan?.SplitTotalCost?.ToString("N0") ?? "0")g
        </MudText>
    </div>
    
    @* Multi-world sections *@
    <div style="display: flex; flex-wrap: wrap;">
        @if (ShoppingPlan?.RecommendedSplit != null)
        {
            @foreach (var split in ShoppingPlan.RecommendedSplit)
            {
                <div style="flex: 1; min-width: 120px; padding: 6px 8px; border-right: 1px solid #3a2a2a; @(ShoppingPlan.RecommendedSplit.IndexOf(split) == ShoppingPlan.RecommendedSplit.Count - 1 ? "border-right: none;" : "")">
                    @* World header *@
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                        <MudText Typo="Typo.caption" Style="color: #90EE90; font-weight: 600;">
                            @split.WorldName
                        </MudText>
                        @if (split.IsPartial)
                        {
                            <MudText Typo="Typo.caption" Style="color: #ff9800; font-size: 10px;">partial</MudText>
                        }
                    </div>
                    
                    @* Purchase details *@
                    <div style="display: flex; justify-content: space-between; align-items: baseline;">
                        <MudText Typo="Typo.caption" Style="color: #d4a73a;">
                            @split.QuantityToBuy × @split.PricePerUnit.ToString("N0")g
                        </MudText>
                        <MudText Typo="Typo.body2" Style="color: #4caf50; font-weight: 600;">
                            @split.TotalCost.ToString("N0")g
                        </MudText>
                    </div>
                </div>
            }
        }
    </div>
    
    @* Footer with comparison *@
    @if (ShoppingPlan?.RecommendedWorld != null && ShoppingPlan.SplitTotalCost.HasValue)
    {
        <div style="display: flex; justify-content: space-between; padding: 3px 8px; background: #1a1510; border-top: 1px solid #3a2a2a;">
            <MudText Typo="Typo.caption" Style="color: #666; font-size: 10px;">
                vs @ShoppingPlan.RecommendedWorld.WorldName: @ShoppingPlan.RecommendedWorld.TotalCost.ToString("N0")g
            </MudText>
            @if (ShoppingPlan.SplitSavingsPercent.HasValue && ShoppingPlan.SplitSavingsPercent.Value > 0)
            {
                <MudText Typo="Typo.caption" Style="color: #4caf50; font-size: 10px;">
                    Save @ShoppingPlan.SplitSavingsPercent.Value.ToString("F0")%
                </MudText>
            }
        </div>
    }
</div>

@code {
    [Parameter]
    public ItemProcurementAnalysis Item { get; set; } = null!;
    
    [Parameter]
    public DetailedShoppingPlan? ShoppingPlan { get; set; }
    
    [Parameter]
    public bool IsSelected { get; set; } = false;
}
