@using FFXIVCraftArchitect.Core.Models
@using FFXIVCraftArchitect.Core.Services

@* Rich vendor display section for expanded item panel *@

<div style="display: flex; flex-direction: column; gap: 20px;">
    
    @* Primary Vendor Card - Full Width *@
    <div style="background: linear-gradient(135deg, #2a2520 0%, #1e1a18 100%); border-radius: 12px; border: 2px solid #d4a73a; padding: 24px;">
        
        @* Header Row *@
        <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">
            <div style="background: #d4a73a; border-radius: 8px; padding: 12px;">
                <MudIcon Icon="@Icons.Material.Filled.Store" Style="color: #1a1a18;" Size="Size.Large" />
            </div>
            <div style="flex: 1;">
                <MudText Typo="Typo.h5" Style="color: #d4a73a; font-weight: 700;">
                    @PrimaryVendor?.Name
                </MudText>
                <div style="display: flex; align-items: center; gap: 12px; margin-top: 4px;">
                    <MudText Typo="Typo.body1" Style="color: #ccc;">
                        @PrimaryVendor?.Location
                    </MudText>
                    @if (PrimaryVendor?.HasCoordinates == true)
                    {
                        <div style="background: #3a3528; border-radius: 4px; padding: 2px 8px;">
                            <MudText Typo="Typo.caption" Style="color: #d4a73a; font-family: monospace;">
                                @PrimaryVendor.CoordinatesDisplay
                            </MudText>
                        </div>
                    }
                </div>
            </div>
            <div style="text-align: right;">
                <MudText Typo="Typo.h4" Style="color: #d4a73a; font-weight: 700;">
                    @PrimaryVendor?.Price.ToString("N0")g
                </MudText>
                <MudText Typo="Typo.caption" Style="color: #888;">
                    @Plan.QuantityNeeded × @PrimaryVendor?.Price.ToString("N0")g = @((PrimaryVendor?.Price * Plan.QuantityNeeded ?? 0).ToString("N0"))g
                </MudText>
            </div>
        </div>
        
        @* Vendor Info Grid *@
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 20px;">
            <div style="background: #252520; border-radius: 8px; padding: 16px;">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                    <MudIcon Icon="@Icons.Material.Filled.LocationOn" Style="color: #888;" Size="Size.Small" />
                    <MudText Typo="Typo.caption" Style="color: #888;">Location</MudText>
                </div>
                <MudText Typo="Typo.body1" Style="color: #fff; font-weight: 500;">
                    @PrimaryVendor?.Location
                </MudText>
                @if (PrimaryVendor?.HasCoordinates == true)
                {
                    <MudText Typo="Typo.caption" Style="color: #d4a73a; margin-top: 4px; display: block;">
                        @PrimaryVendor.CoordinatesDisplay
                    </MudText>
                }
            </div>
            
            <div style="background: #252520; border-radius: 8px; padding: 16px;">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                    <MudIcon Icon="@Icons.Material.Filled.ShoppingCart" Style="color: #888;" Size="Size.Small" />
                    <MudText Typo="Typo.caption" Style="color: #888;">Quantity</MudText>
                </div>
                <MudText Typo="Typo.body1" Style="color: #fff; font-weight: 500;">
                    ×@Plan.QuantityNeeded
                </MudText>
                <MudText Typo="Typo.caption" Style="color: #4caf50; margin-top: 4px; display: block;">
                    Unlimited stock
                </MudText>
            </div>
            
            <div style="background: #252520; border-radius: 8px; padding: 16px;">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                    <MudIcon Icon="@Icons.Material.Filled.AttachMoney" Style="color: #888;" Size="Size.Small" />
                    <MudText Typo="Typo.caption" Style="color: #888;">Price per Unit</MudText>
                </div>
                <MudText Typo="Typo.body1" Style="color: #fff; font-weight: 500;">
                    @PrimaryVendor?.Price.ToString("N0")g
                </MudText>
                <MudText Typo="Typo.caption" Style="color: #888; margin-top: 4px; display: block;">
                    @PrimaryVendor?.Currency
                </MudText>
            </div>
            
            <div style="background: #252520; border-radius: 8px; padding: 16px;">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                    <MudIcon Icon="@Icons.Material.Filled.Summarize" Style="color: #888;" Size="Size.Small" />
                    <MudText Typo="Typo.caption" Style="color: #888;">Total Cost</MudText>
                </div>
                <MudText Typo="Typo.body1" Style="color: #d4a73a; font-weight: 700;">
                    @((PrimaryVendor?.Price * Plan.QuantityNeeded ?? 0).ToString("N0"))g
                </MudText>
            </div>
        </div>
        
        @* Quick Tips *@
        <div style="background: #1a3a1a; border: 1px solid #4caf50; border-radius: 8px; padding: 12px 16px; display: flex; align-items: center; gap: 12px;">
            <MudIcon Icon="@Icons.Material.Filled.Info" Style="color: #4caf50;" Size="Size.Small" />
            <MudText Typo="Typo.body2" Style="color: #90EE90;">
                Purchase from vendor. No market board listings required. Vendors have unlimited stock.
            </MudText>
        </div>
    </div>
    
    @* Alternate Locations Section *@
    @if (AlternateVendors.Any())
    {
        <div style="background: #252520; border-radius: 8px; border: 1px solid #444; padding: 20px;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
                <MudIcon Icon="@Icons.Material.Filled.LocationOn" Style="color: #d4a73a;" Size="Size.Small" />
                <MudText Typo="Typo.subtitle1" Style="color: #d4a73a; font-weight: 600;">
                    Also Available From
                </MudText>
                <MudText Typo="Typo.caption" Style="color: #888; margin-left: auto;">
                    @AlternateVendors.Count alternate location(s)
                </MudText>
            </div>
            
            <div style="display: flex; flex-direction: column; gap: 8px;">
                @foreach (var vendor in AlternateVendors.Take(5))
                {
                    <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; background: #1e1e1a; border-radius: 6px; border: 1px solid #333;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <MudIcon Icon="@Icons.Material.Filled.Store" Style="color: #888;" Size="Size.Small" />
                            <div>
                                <MudText Typo="Typo.body2" Style="color: #ccc; font-weight: 500;">
                                    @vendor.Name
                                </MudText>
                                <div style="display: flex; align-items: center; gap: 8px; margin-top: 2px;">
                                    <MudText Typo="Typo.caption" Style="color: #888;">
                                        @vendor.Location
                                    </MudText>
                                    @if (vendor.HasCoordinates)
                                    {
                                        <MudText Typo="Typo.caption" Style="color: #666; font-family: monospace;">
                                            @vendor.CoordinatesDisplay
                                        </MudText>
                                    }
                                </div>
                            </div>
                        </div>
                        <MudText Typo="Typo.body2" Style="color: #d4a73a; font-weight: 600; min-width: 60px; text-align: right;">
                            @vendor.Price.ToString("N0")g
                        </MudText>
                    </div>
                }
                
                @if (AlternateVendors.Count > 5)
                {
                    <MudText Typo="Typo.caption" Style="color: #666; text-align: center; padding-top: 8px;">
                        +@(AlternateVendors.Count - 5) more locations
                    </MudText>
                }
            </div>
        </div>
    }
</div>

@code {
    [Parameter] public DetailedShoppingPlan Plan { get; set; } = default!;
    
    private VendorInfo? PrimaryVendor => Plan.Vendors?.FirstOrDefault();
    
    private List<VendorInfo> AlternateVendors => 
        Plan.Vendors?.Skip(1).ToList() ?? new List<VendorInfo>();
}
