@using FFXIVCraftArchitect.Core.Services

<div style="background: @(IsSelected ? "#3a3a30" : GetBackgroundColor()); border-radius: 4px; border: 2px solid @(IsSelected ? "#d4a73a" : GetBorderColor()); overflow: hidden; transition: background 0.15s ease;">
    <div style="display: flex; align-items: center; padding: 6px 10px;">
        
        <!-- Selection Indicator -->
        @if (IsSelected)
        {
            <MudIcon Icon="@Icons.Material.Filled.Visibility" 
                     Style="color: #d4a73a; margin-right: 6px;" 
                     Size="Size.Small" />
        }
        else
        {
            <MudIcon Icon="@GetActionIcon()" 
                     Style="@GetActionStyle()" 
                     Size="Size.Small" />
        }
        
        <!-- Item Name -->
        <div style="flex: 1; min-width: 0; overflow: hidden;">
            <MudText Typo="Typo.body2" Style="@GetNameStyle()">
                @Item.Name
            </MudText>
        </div>
        
        <!-- Quantity -->
        <MudText Typo="Typo.caption" Style="color: #d4a73a; margin: 0 8px; min-width: 40px; text-align: right;">
            Ã—@(Item.QuantityNeeded)
        </MudText>
        
        <!-- Action Type Badge -->
        <div style="min-width: 50px; text-align: right; margin-right: 8px;">
            @switch (Item.Recommendation)
            {
                case ProcurementRecommendation.Craft:
                    <MudText Typo="Typo.caption" Style="color: #2196f3; font-weight: 600;">CRAFT</MudText>
                    break;
                case ProcurementRecommendation.BuyFromMarket:
                    <MudText Typo="Typo.caption" Style="color: #4caf50; font-weight: 600;">BUY</MudText>
                    break;
                default:
                    <MudText Typo="Typo.caption" Style="color: #888;">NO DATA</MudText>
                    break;
            }
        </div>
        
        <!-- Cost/World -->
        @if (Item.Recommendation == ProcurementRecommendation.Craft)
        {
            <MudText Typo="Typo.body2" Style="color: #2196f3; font-weight: 600; min-width: 70px; text-align: right;">
                @Item.CraftCost.ToString("N0")g
            </MudText>
        }
        else if (Item.Recommendation == ProcurementRecommendation.BuyFromMarket && Item.BestWorldPurchase != null)
        {
            <div style="text-align: right; min-width: 70px;">
                <MudText Typo="Typo.body2" Style="color: #4caf50; font-weight: 600;">
                    @Item.BestWorldPurchase.TotalCost.ToString("N0")g
                </MudText>
                <MudText Typo="Typo.caption" Style="color: #90EE90; font-size: 10px;">
                    @Item.BestWorldPurchase.WorldName
                </MudText>
            </div>
        }
        else
        {
            <MudText Typo="Typo.caption" Style="color: #666; min-width: 70px; text-align: right;">
                -
            </MudText>
        }
    </div>
</div>

@code {
    [Parameter] public ItemProcurementAnalysis Item { get; set; } = null!;
    [Parameter] public bool IsSelected { get; set; } = false;

    private string GetBackgroundColor() => Item.Recommendation switch
    {
        ProcurementRecommendation.Craft => "#1a3a4a",
        ProcurementRecommendation.BuyFromMarket => "#1a3a2a",
        _ => "#2d2d2d"
    };

    private string GetBorderColor() => Item.Recommendation switch
    {
        ProcurementRecommendation.Craft => "#2196f3",
        ProcurementRecommendation.BuyFromMarket => "#4caf50",
        _ => "#666"
    };

    private string GetActionIcon() => Item.Recommendation switch
    {
        ProcurementRecommendation.Craft => Icons.Material.Filled.Build,
        ProcurementRecommendation.BuyFromMarket => Icons.Material.Filled.ShoppingCart,
        _ => Icons.Material.Filled.Help
    };

    private string GetActionColor() => Item.Recommendation switch
    {
        ProcurementRecommendation.Craft => "#2196f3",
        ProcurementRecommendation.BuyFromMarket => "#4caf50",
        _ => "#666"
    };

    private string GetActionStyle() => Item.Recommendation switch
    {
        ProcurementRecommendation.Craft => "color: #2196f3; margin-right: 6px;",
        ProcurementRecommendation.BuyFromMarket => "color: #4caf50; margin-right: 6px;",
        _ => "color: #666; margin-right: 6px;"
    };

    private string GetNameStyle() => Item.Recommendation == ProcurementRecommendation.NoDataAvailable 
        ? "color: #aaa; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" 
        : "color: #fff; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;";
}
