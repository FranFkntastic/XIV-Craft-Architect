<Window x:Class="FFXIV_Craft_Architect.MarketDataStatusWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        xmlns:helpers="clr-namespace:FFXIV_Craft_Architect.Helpers"
        Title="Market Data Population Status"
        Width="980"
        Height="600"
        WindowStartupLocation="CenterOwner"
        Background="#1e1e1e">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        
        <!-- Header with stats -->
        <Border Grid.Row="0" Background="#2d2d2d" Padding="12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBlock Text="Market Data Population" 
                               FontSize="16" FontWeight="SemiBold" 
                               Foreground="#d4d4d4"/>
                    <TextBlock x:Name="ProgressText" 
                               Text=" - Starting..." 
                               FontSize="16"
                               Foreground="#888888"
                               Margin="8,0,0,0"/>
                </StackPanel>
                
                <ui:Button Grid.Column="1"
                           x:Name="CloseButton"
                           Content="Close"
                           MinWidth="80"
                           MinHeight="28"
                           Appearance="Secondary"
                           Padding="12,4"
                           Click="OnCloseClick"
                           helpers:ButtonAutoShrinkBehavior.EnableAutoShrink="True"/>
            </Grid>
        </Border>
        
        <!-- Stats bar -->
        <Border Grid.Row="1" Background="#252525" Padding="8">
            <StackPanel Orientation="Horizontal">
                <TextBlock x:Name="PendingCount" Text="â³ Pending: 0" Foreground="#888888" Margin="0,0,16,0"/>
                <TextBlock x:Name="NoCacheCount" Text="âˆ… No Cache: 0" Foreground="#f59e0b" Margin="0,0,16,0"/>
                <TextBlock x:Name="FetchingCount" Text="ðŸ”„ Fetching: 0" Foreground="#4ecdc4" Margin="0,0,16,0"/>
                <TextBlock x:Name="SuccessCount" Text="âœ“ Success: 0" Foreground="#4ade80" Margin="0,0,16,0"/>
                <TextBlock x:Name="FailedCount" Text="âœ— Failed: 0" Foreground="#f87171" Margin="0,0,16,0"/>
                <TextBlock x:Name="SkippedCount" Text="â†· Skipped: 0" Foreground="#94a3b8" Margin="0,0,16,0"/>
                <TextBlock x:Name="CachedCount" Text="ðŸ“‹ Cached: 0" Foreground="#fbbf24" Margin="0,0,16,0"/>
            </StackPanel>
        </Border>
        
        <!-- Data Grid -->
        <Border Grid.Row="2" Background="#1e1e1e" Margin="0">
            <DataGrid x:Name="StatusDataGrid"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      GridLinesVisibility="Horizontal"
                      HeadersVisibility="Column"
                      Background="#1e1e1e"
                      RowBackground="#252525"
                      AlternatingRowBackground="#2a2a2a"
                      BorderThickness="0"
                      CanUserSortColumns="True">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Status" Binding="{Binding StatusText}" Width="120">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="{Binding StatusColor, Converter={StaticResource StringToBrushConverter}}"/>
                                <Setter Property="FontWeight" Value="SemiBold"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <DataGridTextColumn Header="Item" Binding="{Binding ItemName}" Width="*">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="#d4d4d4"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <DataGridTextColumn Header="Qty" Binding="{Binding Quantity}" Width="60">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="#888888"/>
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <DataGridTextColumn Header="Price" Binding="{Binding PriceDisplay}" Width="100">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="#d4af37"/>
                                <Setter Property="HorizontalAlignment" Value="Right"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <DataGridTextColumn Header="Age" Binding="{Binding CacheAgeText}" Width="80">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="#888888"/>
                                <Setter Property="FontSize" Value="10"/>
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                                <Setter Property="FontStyle" Value="Italic"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <DataGridTextColumn Header="Data Scope" Binding="{Binding DataScopeText}" Width="170">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="#888888"/>
                                <Setter Property="FontSize" Value="10"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <DataGridTextColumn Header="Retrieval" Binding="{Binding RetrievalSourceText}" Width="130">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="#9ad0f5"/>
                                <Setter Property="FontSize" Value="10"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <DataGridTextColumn Header="Data Type" Binding="{Binding DataTypeText}" Width="100">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="#cbd5e1"/>
                                <Setter Property="FontSize" Value="10"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <DataGridTextColumn Header="Error" Binding="{Binding ErrorMessage}" Width="200">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="#f87171"/>
                                <Setter Property="FontSize" Value="10"/>
                                <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Border>
        
        <!-- Action and Filter buttons -->
        <Border Grid.Row="3" Background="#2d2d2d" Padding="8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <!-- Actions (left side) -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="0,0,16,0">
                    <ui:Button Content="Check Cache"
                               MinWidth="110"
                               MinHeight="28"
                               Appearance="Secondary"
                               Padding="12,4"
                               Margin="0,0,8,0"
                               Click="OnCheckCache"
                               ToolTip="Inspect cache coverage for this plan without fetching from API"
                               helpers:ButtonAutoShrinkBehavior.EnableAutoShrink="True"/>

                    <ui:Button Content="Refresh Market Data"
                               MinWidth="150"
                               MinHeight="28"
                               Appearance="Secondary"
                               Padding="12,4"
                               Click="OnRefreshMarketData"
                               ToolTip="Fetch fresh market data from Universalis"
                               helpers:ButtonAutoShrinkBehavior.EnableAutoShrink="True"/>
                </StackPanel>
                
                <!-- Filter buttons (right side) -->
                <WrapPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
                    <TextBlock Text="Filter:" VerticalAlignment="Center" Foreground="#888888" Margin="0,0,8,0"/>
                    <ui:Button Content="All" MinWidth="64" MinHeight="28" Appearance="Secondary" Padding="10,4" Margin="0,0,4,0" Click="OnFilterAll" helpers:ButtonAutoShrinkBehavior.EnableAutoShrink="True"/>
                    <ui:Button Content="Pending" MinWidth="76" MinHeight="28" Appearance="Secondary" Padding="10,4" Margin="0,0,4,0" Click="OnFilterPending" helpers:ButtonAutoShrinkBehavior.EnableAutoShrink="True"/>
                    <ui:Button Content="Fetching" MinWidth="82" MinHeight="28" Appearance="Secondary" Padding="10,4" Margin="0,0,4,0" Click="OnFilterFetching" helpers:ButtonAutoShrinkBehavior.EnableAutoShrink="True"/>
                    <ui:Button Content="Failed" MinWidth="68" MinHeight="28" Appearance="Secondary" Padding="10,4" Margin="0,0,4,0" Click="OnFilterFailed" helpers:ButtonAutoShrinkBehavior.EnableAutoShrink="True"/>
                    <ui:Button Content="Success" MinWidth="76" MinHeight="28" Appearance="Secondary" Padding="10,4" Margin="0,0,4,0" Click="OnFilterSuccess" helpers:ButtonAutoShrinkBehavior.EnableAutoShrink="True"/>
                    <ui:Button Content="Export CSV" MinWidth="96" MinHeight="28" Appearance="Primary" Padding="12,4" Margin="16,0,0,0" Click="OnExportCsv" helpers:ButtonAutoShrinkBehavior.EnableAutoShrink="True"/>
                </WrapPanel>
            </Grid>
        </Border>
    </Grid>
</Window>
