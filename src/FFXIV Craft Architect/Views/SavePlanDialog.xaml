<Window x:Class="FFXIV_Craft_Architect.SavePlanDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        Title="Save Plan"
        Width="550"
        Height="500"
        WindowStartupLocation="CenterOwner"
        Background="#1e1e1e"
        MinWidth="450"
        MinHeight="350">

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <TextBlock Grid.Row="0"
                   Text="Save Plan"
                   FontSize="20"
                   FontWeight="Bold"
                   Margin="0,0,0,8"/>

        <!-- Name Input -->
        <Grid Grid.Row="1" Margin="0,0,0,12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="8" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            
            <TextBlock Grid.Column="0"
                       Text="Plan Name:"
                       VerticalAlignment="Center"/>
            
            <ui:TextBox Grid.Column="2"
                        x:Name="PlanNameTextBox"
                        TextChanged="OnNameChanged"/>
        </Grid>

        <!-- Existing Plans -->
        <Border Grid.Row="2"
                Background="#2d2d2d"
                CornerRadius="4"
                Padding="8">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>
                
                <TextBlock Grid.Row="0"
                           Text="Select existing plan to overwrite (optional):"
                           Foreground="Gray"
                           FontSize="12"
                           Margin="0,0,0,8"/>
                
                <ListBox Grid.Row="1"
                         x:Name="PlansListBox"
                         Background="Transparent"
                         BorderThickness="0"
                         SelectionChanged="OnPlanSelected">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Border Padding="6" Margin="0,2">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0"
                                               Text="{Binding Name}"
                                               FontWeight="SemiBold"/>

                                    <TextBlock Grid.Column="1"
                                               Text="{Binding ModifiedAt, StringFormat={}{0:yyyy-MM-dd HH:mm}}"
                                               Foreground="Gray"
                                               FontSize="11"
                                               Margin="8,0,0,0"/>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </Grid>
        </Border>

        <!-- Buttons -->
        <Grid Grid.Row="3" Margin="0,16,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="8" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <ui:Button Grid.Column="0"
                       Content="Save as New"
                       Appearance="Primary"
                       Click="OnSaveNew"
                       x:Name="SaveNewButton"
                       IsEnabled="False"/>

            <ui:Button Grid.Column="2"
                       Content="Overwrite"
                       Appearance="Secondary"
                       Click="OnOverwrite"
                       x:Name="OverwriteButton"
                       IsEnabled="False"/>

            <ui:Button Grid.Column="4"
                       Content="Cancel"
                       Appearance="Secondary"
                       Click="OnCancel"/>
        </Grid>
    </Grid>
</Window>
