<Window x:Class="FFXIV_Craft_Architect.CacheDiagnosticsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        Title="Cache Diagnostics"
        Width="900"
        Height="700"
        WindowStartupLocation="CenterOwner"
        Background="#1e1e1e">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="200" />
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <Border Grid.Row="0" Background="#2d2d2d" Padding="12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0" 
                           Text="Market Cache Diagnostics" 
                           FontSize="16" FontWeight="SemiBold" 
                           Foreground="#d4d4d4"/>
                
                <ui:Button Grid.Column="1"
                           Content="Close"
                           Width="80"
                           Appearance="Secondary"
                           Padding="12,4"
                           Click="OnCloseClick"/>
            </Grid>
        </Border>
        
        <!-- Stats bar -->
        <Border Grid.Row="1" Background="#252525" Padding="8">
            <StackPanel Orientation="Horizontal">
                <TextBlock x:Name="EntriesCount" Text="Entries: 0" Foreground="#888888" Margin="0,0,16,0"/>
                <TextBlock x:Name="DbSizeText" Text="DB: 0 bytes" Foreground="#888888" Margin="0,0,16,0"/>
                <TextBlock x:Name="WalSizeText" Text="WAL: 0 bytes" Foreground="#fbbf24" Margin="0,0,16,0"/>
                <TextBlock x:Name="OldestText" Text="Oldest: -" Foreground="#888888" Margin="0,0,16,0"/>
                <TextBlock x:Name="NewestText" Text="Newest: -" Foreground="#888888"/>
            </StackPanel>
        </Border>
        
        <!-- Data Grid -->
        <Border Grid.Row="2" Background="#1e1e1e" Margin="0">
            <DataGrid x:Name="CacheDataGrid"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      GridLinesVisibility="Horizontal"
                      HeadersVisibility="Column"
                      Background="#1e1e1e"
                      RowBackground="#252525"
                      AlternatingRowBackground="#2a2a2a"
                      BorderThickness="0"
                      CanUserSortColumns="True"
                      SelectionChanged="OnSelectionChanged">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Item ID" Binding="{Binding ItemId}" Width="80">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="#d4d4d4"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <DataGridTextColumn Header="DC" Binding="{Binding DataCenter}" Width="80">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="#888888"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <DataGridTextColumn Header="Fetched" Binding="{Binding FetchedAt}" Width="130">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="#888888"/>
                                <Setter Property="FontSize" Value="10"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <DataGridTextColumn Header="Age" Binding="{Binding AgeText}" Width="80">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="#4ecdc4"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <DataGridTextColumn Header="DC Avg" Binding="{Binding DCAveragePrice}" Width="90">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="#d4af37"/>
                                <Setter Property="HorizontalAlignment" Value="Right"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <DataGridTextColumn Header="Worlds" Binding="{Binding WorldsCount}" Width="60">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="#888888"/>
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <DataGridTextColumn Header="Listings" Binding="{Binding ListingsCount}" Width="60">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="#888888"/>
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <DataGridTextColumn Header="Size" Binding="{Binding DataSizeText}" Width="70">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="#888888"/>
                                <Setter Property="FontSize" Value="10"/>
                                <Setter Property="HorizontalAlignment" Value="Right"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Border>
        
        <!-- Details and Actions -->
        <Grid Grid.Row="3">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="280"/>
            </Grid.ColumnDefinitions>
            
            <!-- Details Panel -->
            <Border Grid.Column="0" Background="#252525" BorderBrush="#3d3d3d" BorderThickness="0,1,1,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Row="0" 
                               x:Name="DetailsHeader"
                               Text="Entry Details (select an item)" 
                               FontWeight="SemiBold" 
                               Foreground="#d4d4d4"
                               Padding="8,4"
                               Background="#2d2d2d"/>
                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Margin="8">
                        <TextBlock x:Name="DetailsText" 
                                   FontFamily="Consolas" 
                                   FontSize="11"
                                   TextWrapping="Wrap" 
                                   Foreground="#d4d4d4"
                                   Text="No item selected"/>
                    </ScrollViewer>
                </Grid>
            </Border>
            
            <!-- Actions Panel -->
            <Border Grid.Column="1" Background="#2d2d2d" BorderBrush="#3d3d3d" BorderThickness="0,1,0,0" Padding="12">
                <StackPanel>
                    <TextBlock Text="Database Path:" Foreground="#888888" FontSize="10" Margin="0,0,0,4"/>
                    <TextBlock x:Name="DbPathText" Text="-" Foreground="#d4d4d4" FontSize="10" TextWrapping="Wrap" Margin="0,0,0,12"/>
                    
                    <TextBlock Text="Actions:" Foreground="#888888" FontSize="10" Margin="0,0,0,8"/>
                    
                    <ui:Button Content="Refresh" MinHeight="28" Appearance="Secondary" Padding="12,4" Margin="0,0,0,8" Click="OnRefreshClick"/>
                    <ui:Button Content="Force Checkpoint (WAL)" MinHeight="28" Appearance="Secondary" Padding="12,4" Margin="0,0,0,8" Click="OnCheckpointClick"/>
                    <ui:Button Content="Vacuum Database" MinHeight="28" Appearance="Secondary" Padding="12,4" Margin="0,0,0,8" Click="OnVacuumClick"/>
                    <ui:Button Content="Clear Cache" MinHeight="28" Appearance="Danger" Padding="12,4" Margin="0,0,0,0" Click="OnClearCacheClick"/>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</Window>
