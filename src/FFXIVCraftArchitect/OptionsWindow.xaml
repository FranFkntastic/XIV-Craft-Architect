<Window x:Class="FFXIVCraftArchitect.OptionsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        xmlns:helpers="clr-namespace:FFXIVCraftArchitect.Helpers"
        Title="Options"
        Width="600"
        Height="500"
        WindowStartupLocation="CenterOwner"
        Background="#1e1e1e"
        ResizeMode="NoResize">

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <TextBlock Grid.Row="0"
                   Text="Settings"
                   FontSize="20"
                   FontWeight="SemiBold"
                   Margin="0,0,0,16"
                   Foreground="#d4af37"/>

        <!-- Settings Tabs -->
        <ui:TabView Grid.Row="1" 
                    Background="#252525"
                    Padding="8">
            
            <!-- UI Tab -->
            <ui:TabViewItem Header="Appearance">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="8">
                        <TextBlock Text="Accent Color"
                                   FontWeight="SemiBold"
                                   Margin="0,8,0,4"
                                   Foreground="#cccccc"/>
                        <TextBlock Text="Choose your accent color (hex format like #d4af37)"
                                   FontSize="11"
                                   Foreground="#888888"
                                   Margin="0,0,0,8"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="8" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <TextBox x:Name="AccentColorTextBox"
                                     Grid.Column="0"
                                     Text="#d4af37"
                                     MaxLength="7"/>
                            <Border Grid.Column="2"
                                    x:Name="AccentColorPreview"
                                    Width="32"
                                    Height="32"
                                    Background="#d4af37"
                                    CornerRadius="4"
                                    BorderBrush="#555555"
                                    BorderThickness="1"/>
                        </Grid>

                        <TextBlock Text="Preset Colors"
                                   FontSize="11"
                                   Foreground="#888888"
                                   Margin="0,16,0,8"/>
                        <WrapPanel x:Name="PresetColorsPanel">
                            <Button Width="32" 
                                    Height="32" 
                                    Margin="4"
                                    Background="#d4af37"
                                    BorderBrush="#666666"
                                    Click="OnPresetColorClick"/>
                            <Button Width="32" 
                                    Height="32" 
                                    Margin="4"
                                    Background="#4ecdc4"
                                    BorderBrush="#666666"
                                    Click="OnPresetColorClick"/>
                            <Button Width="32" 
                                    Height="32" 
                                    Margin="4"
                                    Background="#ff6b6b"
                                    BorderBrush="#666666"
                                    Click="OnPresetColorClick"/>
                            <Button Width="32" 
                                    Height="32" 
                                    Margin="4"
                                    Background="#95e1d3"
                                    BorderBrush="#666666"
                                    Click="OnPresetColorClick"/>
                            <Button Width="32" 
                                    Height="32" 
                                    Margin="4"
                                    Background="#f38181"
                                    BorderBrush="#666666"
                                    Click="OnPresetColorClick"/>
                            <Button Width="32" 
                                    Height="32" 
                                    Margin="4"
                                    Background="#aa96da"
                                    BorderBrush="#666666"
                                    Click="OnPresetColorClick"/>
                            <Button Width="32" 
                                    Height="32" 
                                    Margin="4"
                                    Background="#fcbad3"
                                    BorderBrush="#666666"
                                    Click="OnPresetColorClick"/>
                            <Button Width="32" 
                                    Height="32" 
                                    Margin="4"
                                    Background="#a8d8ea"
                                    BorderBrush="#666666"
                                    Click="OnPresetColorClick"/>
                        </WrapPanel>

                        <Separator Margin="0,16"/>

                        <TextBlock Text="Market Analysis Layout"
                                   FontWeight="SemiBold"
                                   Margin="0,8,0,4"
                                   Foreground="#cccccc"/>
                        <TextBlock Text="Choose between the modern split-pane view (like the web app) or the legacy card-based view."
                                   FontSize="11"
                                   Foreground="#888888"
                                   Margin="0,0,0,8"
                                   TextWrapping="Wrap"/>
                        <ui:ToggleSwitch x:Name="UseSplitPaneMarketViewToggle"
                                         Content="Use split-pane market view"
                                         Margin="0,4"
                                         ToolTip="Modern layout: expanded items on top, collapsed cards below (like web app)"/>
                    </StackPanel>
                </ScrollViewer>
            </ui:TabViewItem>

            <!-- Market Tab -->
            <ui:TabViewItem Header="Market">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="8">
                        <TextBlock Text="Default Data Center"
                                   FontWeight="SemiBold"
                                   Margin="0,8,0,4"
                                   Foreground="#cccccc"/>
                        <ComboBox x:Name="DefaultDataCenterCombo"
                                  Margin="0,0,0,8"
                                  helpers:ComboBoxAutoWidthBehavior.EnableAutoWidth="True">
                            <ComboBoxItem Content="Aether"/>
                            <ComboBoxItem Content="Primal"/>
                            <ComboBoxItem Content="Crystal"/>
                            <ComboBoxItem Content="Dynamis"/>
                            <ComboBoxItem Content="Chaos"/>
                            <ComboBoxItem Content="Light"/>
                            <ComboBoxItem Content="Elemental"/>
                            <ComboBoxItem Content="Gaia"/>
                            <ComboBoxItem Content="Mana"/>
                            <ComboBoxItem Content="Meteor"/>
                        </ComboBox>

                        <TextBlock Text="Home World"
                                   FontWeight="SemiBold"
                                   Margin="0,8,0,4"
                                   Foreground="#cccccc"/>
                        <TextBlock Text="Your character's home world (optional). Home worlds bypass congested world restrictions in recommendations."
                                   FontSize="11"
                                   Foreground="#888888"
                                   Margin="0,0,0,8"/>
                        <TextBox x:Name="HomeWorldTextBox"
                                 Margin="0,0,0,16"
                                 ToolTip="Enter your home world name (e.g., Gilgamesh, Balmung)"
                                 Text=""/>

                        <ui:ToggleSwitch x:Name="AutoFetchPricesToggle"
                                         Content="Auto-fetch prices on plan build"
                                         Margin="0,8"
                                         ToolTip="Automatically fetch market prices after building a project plan"/>

                        <ui:ToggleSwitch x:Name="ExcludeCongestedWorldsToggle"
                                         Content="Exclude congested worlds from market fetch"
                                         Margin="0,8"
                                         ToolTip="Skip fetching market data for congested worlds (except your home world). Reduces API calls and improves performance."/>

                        <ui:ToggleSwitch x:Name="ParallelApiRequestsToggle"
                                         Content="Use parallel API requests"
                                         Margin="0,8"
                                         ToolTip="Fetch multiple chunks of market data simultaneously for faster loading on large lists. Automatically disabled for small lists."/>

                        <Separator Margin="0,16"/>

                        <!-- World Status Section -->
                        <TextBlock Text="World Status"
                                   FontWeight="SemiBold"
                                   Margin="0,8,0,4"
                                   Foreground="#cccccc"/>
                        <TextBlock x:Name="WorldStatusText"
                                   Text="Status unknown - refresh to load"
                                   FontSize="11"
                                   Foreground="#888888"
                                   Margin="0,0,0,8"/>
                        <StackPanel Orientation="Horizontal">
                            <ui:Button x:Name="RefreshWorldStatusButton"
                                       Content="Refresh World Status"
                                       Click="OnRefreshWorldStatusClick"
                                       Margin="0,0,8,0"/>
                            <TextBlock x:Name="WorldStatusLastUpdated"
                                       Text=""
                                       FontSize="11"
                                       Foreground="#888888"
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                        <TextBlock Text="Fetches current world congestion data from the Lodestone. Congested worlds are marked in market recommendations."
                                   FontSize="10"
                                   Foreground="#666666"
                                   Margin="0,4,0,0"
                                   TextWrapping="Wrap"/>

                        <!-- Include cross-world data toggle (Hidden - Not Implemented) -->
                        <ui:ToggleSwitch x:Name="IncludeCrossWorldToggle"
                                         Content="Include cross-world data"
                                         Margin="0,8"
                                         ToolTip="Include data from all worlds in the data center"
                                         Visibility="Collapsed"/>
                    </StackPanel>
                </ScrollViewer>
            </ui:TabViewItem>

            <!-- Planning Tab -->
            <ui:TabViewItem Header="Planning">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="8">
                        <TextBlock Text="Default Recommendation Mode"
                                   FontWeight="SemiBold"
                                   Margin="0,8,0,4"
                                   Foreground="#cccccc"/>
                        <ComboBox x:Name="DefaultRecommendationModeCombo"
                                  Margin="0,0,0,16"
                                  helpers:ComboBoxAutoWidthBehavior.EnableAutoWidth="True">
                            <ComboBoxItem Content="Minimize Total Cost" ToolTip="Only buy what is needed"/>
                            <ComboBoxItem Content="Maximize Value" ToolTip="Best price per unit, good for frequent crafts"/>
                        </ComboBox>
                    </StackPanel>
                </ScrollViewer>
            </ui:TabViewItem>

            <!-- Debugging Tab -->
            <ui:TabViewItem Header="Debugging">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="8">
                        <TextBlock Text="Diagnostic Logging"
                                   FontWeight="SemiBold"
                                   Margin="0,8,0,4"
                                   Foreground="#cccccc"/>
                        <TextBlock Text="Enable detailed diagnostic output for troubleshooting. Changes take effect immediately."
                                   FontSize="11"
                                   Foreground="#888888"
                                   Margin="0,0,0,8"/>
                        
                        <ui:ToggleSwitch x:Name="EnableDiagnosticLoggingToggle"
                                         Content="Enable RecipePlanner diagnostic logging"
                                         Margin="0,8"
                                         ToolTip="Logs detailed RecipePlanner VM operations to debug.log"/>

                        <Separator Margin="0,16"/>

                        <TextBlock Text="Log Level"
                                   FontWeight="SemiBold"
                                   Margin="0,8,0,4"
                                   Foreground="#cccccc"/>
                        <TextBlock Text="Minimum log level to write to debug.log. Debug produces the most output, Error the least."
                                   FontSize="11"
                                   Foreground="#888888"
                                   Margin="0,0,0,8"/>
                        <ComboBox x:Name="LogLevelCombo"
                                  Margin="0,0,0,16"
                                  helpers:ComboBoxAutoWidthBehavior.EnableAutoWidth="True">
                            <ComboBoxItem Content="Debug (Verbose)" ToolTip="All log messages including detailed debug output"/>
                            <ComboBoxItem Content="Info" ToolTip="Informational messages and above (default)"/>
                            <ComboBoxItem Content="Warning" ToolTip="Warnings and errors only"/>
                            <ComboBoxItem Content="Error" ToolTip="Errors only"/>
                        </ComboBox>

                        <Separator Margin="0,16"/>

                        <TextBlock Text="Debug Tools"
                                   FontWeight="SemiBold"
                                   Margin="0,8,0,4"
                                   Foreground="#cccccc"/>
                        <ui:Button Content="View Logs"
                                   Click="OnViewLogsClick"
                                   Margin="0,8"
                                   ToolTip="Open the log viewer window"/>
                        <TextBlock Text="Opens debug.log in the log viewer for troubleshooting."
                                   FontSize="11"
                                   Foreground="#888888"
                                   Margin="0,0,0,8"/>
                    </StackPanel>
                </ScrollViewer>
            </ui:TabViewItem>
        </ui:TabView>

        <!-- Buttons -->
        <Grid Grid.Row="2" Margin="0,16,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="8" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="8" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <ui:Button Grid.Column="0"
                       Content="Open Settings File"
                       Appearance="Secondary"
                       Click="OnOpenSettingsFile"
                       ToolTip="Open the settings.json file in your default text editor"
                       helpers:ButtonAutoShrinkBehavior.EnableAutoShrink="True"/>

            <ui:Button Grid.Column="3"
                       Content="Reset to Defaults"
                       Appearance="Secondary"
                       Click="OnResetDefaults"
                       helpers:ButtonAutoShrinkBehavior.EnableAutoShrink="True"/>

            <ui:Button Grid.Column="5"
                       Content="Save"
                       Appearance="Primary"
                       Click="OnSave"
                       helpers:ButtonAutoShrinkBehavior.EnableAutoShrink="True"/>
        </Grid>
    </Grid>
</Window>
