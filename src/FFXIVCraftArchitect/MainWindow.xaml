<Window x:Class="FFXIVCraftArchitect.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        Title="FFXIV Craft Architect v0.1.0"
        Width="1600"
        Height="1000"
        WindowStartupLocation="CenterScreen"
        Background="#1e1e1e"
        xmlns:helpers="clr-namespace:FFXIVCraftArchitect.Helpers">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Title Bar with Menu -->
        <Border Grid.Row="0" 
                Background="#1a1a1a"
                BorderBrush="{DynamicResource AccentBrush}"
                BorderThickness="0,0,0,1"
                Padding="8,0,8,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" 
                           Text="FFXIV Craft Architect" 
                           FontSize="12"
                           FontWeight="SemiBold"
                           VerticalAlignment="Center"
                           Margin="0,0,12,0"
                           Foreground="{DynamicResource AccentBrush}"/>

                <!-- Menu Bar -->
                <Menu Grid.Column="1" 
                      Background="Transparent"
                      VerticalAlignment="Center"
                      Padding="0"
                      FontSize="12">
                    <Menu.Resources>
                        <Style TargetType="MenuItem">
                            <Setter Property="Foreground" Value="#cccccc"/>
                            <Setter Property="Padding" Value="8,2"/>
                            <Style.Triggers>
                                <Trigger Property="IsHighlighted" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource AccentBrush}"/>
                                    <Setter Property="Foreground" Value="#1a1a1a"/>
                                </Trigger>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource AccentBrush}"/>
                                    <Setter Property="Foreground" Value="#1a1a1a"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Menu.Resources>

                    <MenuItem Header="File">
                        <MenuItem Header="New Plan" Click="OnNewPlan"/>
                        <MenuItem Header="Save Plan..." Click="OnSavePlan"/>
                        <MenuItem Header="Load Plans..." Click="OnViewPlans"/>
                        <Separator/>
                        <MenuItem Header="View Logs" Click="OnViewLogs"/>
                    </MenuItem>

                    <MenuItem Header="Import">
                        <MenuItem Header="From Teamcraft (Text)..." 
                                  Click="OnImportTeamcraft"
                                  ToolTip="Import from Teamcraft's Copy as Text feature"/>
                        <MenuItem Header="From Artisan (JSON)" 
                                  Click="OnImportArtisan"
                                  ToolTip="Import from Artisan export (reads clipboard)"/>
                    </MenuItem>

                    <MenuItem Header="Export">
                        <MenuItem Header="To Teamcraft URL" 
                                  Click="OnExportTeamcraft"
                                  ToolTip="Export as Teamcraft URL (copied to clipboard)"/>
                        <MenuItem Header="To Artisan (JSON)" 
                                  Click="OnExportArtisan"
                                  ToolTip="Export as Artisan JSON (copied to clipboard)"/>
                        <Separator/>
                        <MenuItem Header="Copy as Plain Text" 
                                  Click="OnExportPlainText"
                                  ToolTip="Copy plan as text to clipboard"/>
                        <MenuItem Header="Copy as CSV" 
                                  Click="OnExportCsv"
                                  ToolTip="Copy shopping list as CSV to clipboard"/>
                    </MenuItem>

                    <MenuItem Header="Tools">
                        <!-- View Inventory hidden - not implemented yet -->
                        <!-- <MenuItem Header="View Inventory" Click="OnViewInventory"/> -->
                        <MenuItem Header="Fetch Prices" Click="OnFetchPrices"/>
                        <MenuItem Header="View Plan Market Data" Click="OnViewMarketStatus" IsEnabled="False" x:Name="MenuViewMarketStatus"/>
                        <Separator/>
                        <MenuItem Header="Options..." Click="OnOptions"/>
                    </MenuItem>
                </Menu>
            </Grid>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="280" />
                <ColumnDefinition Width="350" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- Left Sidebar: Controls -->
            <Border Grid.Column="0" 
                    Background="Transparent" 
                    BorderBrush="Transparent"
                    BorderThickness="0,0,1,0"
                    Padding="16,0,16,16">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <!-- Sync Section (Hidden - Not Implemented) -->
                        <ui:Button x:Name="SyncButton"
                                   Content="Sync Teamcraft Inventory"
                                   Appearance="Primary"
                                   Icon="{ui:SymbolIcon ArrowSyncCircle24}"
                                   HorizontalAlignment="Stretch"
                                   Margin="0,0,0,8"
                                   Visibility="Collapsed"/>

                        <!-- Live Mode Toggle (Hidden - Not Implemented) -->
                        <ui:ToggleSwitch x:Name="LiveSwitch"
                                         Content="Live Mode (Packet Capture)"
                                         Margin="0,8"
                                         Visibility="Collapsed"/>

                        <TextBlock x:Name="SyncStatus"
                                   Text="Inventory: Not Synced"
                                   FontSize="12"
                                   Foreground="LightGray"
                                   Margin="0,0,0,20"
                                   Visibility="Collapsed"/>

                        <!-- Data Center -->
                        <TextBlock Text="Data Center:" 
                                   Margin="0,10,0,4"/>
                        <ComboBox x:Name="DcCombo"
                                  IsEditable="False"
                                  SelectionChanged="OnDataCenterSelected"/>

                        <TextBlock Text="World:" 
                                   Margin="0,10,0,4"/>
                        <ComboBox x:Name="WorldCombo"
                                  IsEditable="False"/>

                        <!-- Item Search -->
                        <TextBlock Text="Item Name:" 
                                   Margin="0,20,0,4"/>
                        <ui:TextBox x:Name="ItemSearch"
                                    PlaceholderText="Enter item..."
                                    KeyDown="OnItemSearchKeyDown"/>

                        <ui:Button Content="Search"
                                   Icon="{ui:SymbolIcon Search24}"
                                   Margin="0,8"
                                   HorizontalAlignment="Stretch"
                                   Click="OnSearchItem"
                                   helpers:ButtonAutoShrinkBehavior.EnableAutoShrink="True"/>

                        <!-- Action Buttons -->
                    </StackPanel>
                </ScrollViewer>
            </Border>

            <!-- Middle Panel: Search Results and Project Items -->
            <Border Grid.Column="1" 
                    Background="Transparent"
                    BorderBrush="Transparent"
                    BorderThickness="1,0,1,0"
                    Padding="16,0,16,16">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <!-- Search Results -->
                    <Border Grid.Row="0" 
                            Background="#2d2d2d"
                            CornerRadius="4"
                            Padding="8"
                            BorderBrush="{DynamicResource AccentBrush}"
                            BorderThickness="1">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <TextBlock Text="Search Results" 
                                       FontWeight="SemiBold"
                                       Margin="0,0,0,8"
                                       Foreground="{DynamicResource AccentBrush}"/>

                            <ListBox Grid.Row="1"
                                     x:Name="SearchResults"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     SelectionChanged="OnItemSelected"/>

                            <ui:Button Grid.Row="2"
                                       x:Name="AddToProjectButton"
                                       Content="Add to Project"
                                       Appearance="Primary"
                                       Margin="0,8,0,0"
                                       HorizontalAlignment="Stretch"
                                       IsEnabled="False"
                                       Click="OnAddToProject"
                                       helpers:ButtonAutoShrinkBehavior.EnableAutoShrink="True"/>
                        </Grid>
                    </Border>

                    <!-- Divider -->
                    <Border Grid.Row="1" Height="16" Background="Transparent"/>

                    <!-- Project Items -->
                    <Border Grid.Row="2" 
                            Background="#2d2d2d"
                            CornerRadius="4"
                            Padding="8"
                            BorderBrush="{DynamicResource AccentBrush}"
                            BorderThickness="1">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Quick View" 
                                           FontWeight="SemiBold"
                                           Margin="0,0,0,8"
                                           Foreground="{DynamicResource AccentBrush}"/>
                                <TextBlock x:Name="QuickViewCountText"
                                           Grid.Column="1"
                                           Text=""
                                           FontSize="10"
                                           Foreground="#888888"
                                           VerticalAlignment="Center"/>
                            </Grid>

                            <!-- Project Items List - Quick View (shows first 5 items) -->
                            <ListBox Grid.Row="1"
                                     x:Name="ProjectList"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     MaxHeight="200">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <Border Padding="4" Margin="0,2">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="22" />
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="60" />
                                                    <ColumnDefinition Width="8" />
                                                    <ColumnDefinition Width="60" />
                                                </Grid.ColumnDefinitions>

                                                <!-- Delete button - small red X -->
                                                <Button Grid.Column="0"
                                                        Content="Ã—"
                                                        Width="18"
                                                        Height="18"
                                                        FontSize="12"
                                                        Padding="0"
                                                        Margin="0"
                                                        Foreground="Red"
                                                        Background="Transparent"
                                                        BorderThickness="0"
                                                        Click="OnRemoveProjectItem"
                                                        ToolTip="Remove item"/>

                                                <TextBlock Grid.Column="1"
                                                           Text="{Binding Name}" 
                                                           VerticalAlignment="Center"
                                                           TextTrimming="CharacterEllipsis"
                                                           Margin="4,0,0,0"/>

                                                <CheckBox Grid.Column="2"
                                                          Content="HQ"
                                                          IsChecked="{Binding IsHqRequired, Mode=TwoWay}"
                                                          VerticalAlignment="Center"
                                                          HorizontalAlignment="Center"
                                                          Foreground="Gold"
                                                          FontSize="10"
                                                          ToolTip="Craft as High Quality"/>

                                                <!-- Column 3 is empty spacer -->

                                                <TextBox Grid.Column="4"
                                                         Text="{Binding Quantity, Mode=TwoWay, UpdateSourceTrigger=LostFocus}"
                                                         VerticalAlignment="Center"
                                                         HorizontalAlignment="Stretch"
                                                         HorizontalContentAlignment="Center"
                                                         GotFocus="OnQuantityGotFocus"
                                                         PreviewTextInput="OnQuantityPreviewTextInput"
                                                         LostFocus="OnQuantityChanged"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>

                            <ui:Button Grid.Row="2"
                                       x:Name="BuildPlanButton"
                                       Content="Build Project Plan"
                                       Appearance="Success"
                                       Margin="0,8,0,0"
                                       HorizontalAlignment="Stretch"
                                       IsEnabled="False"
                                       Click="OnBuildProjectPlan"
                                       helpers:ButtonAutoShrinkBehavior.EnableAutoShrink="True"/>
                            
                            <ui:Button Grid.Row="3"
                                       x:Name="ManageItemsButton"
                                       Content="Manage Items..."
                                       Appearance="Secondary"
                                       Margin="0,4,0,0"
                                       HorizontalAlignment="Stretch"
                                       Click="OnManageItemsClick"
                                       helpers:ButtonAutoShrinkBehavior.EnableAutoShrink="True"/>

                            <!-- Quick Actions -->
                            <Grid Grid.Row="4" Margin="0,8,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="4" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <ui:Button Grid.Column="0"
                                           Content="Save Plan"
                                           Appearance="Secondary"
                                           HorizontalAlignment="Stretch"
                                           Click="OnSavePlan"
                                           helpers:ButtonAutoShrinkBehavior.EnableAutoShrink="True"/>

                                <ui:Button Grid.Column="2"
                                           Content="Load Plan"
                                           Appearance="Primary"
                                           HorizontalAlignment="Stretch"
                                           Click="OnViewPlans"
                                           helpers:ButtonAutoShrinkBehavior.EnableAutoShrink="True"/>
                            </Grid>

                        </Grid>
                    </Border>
                </Grid>
            </Border>
            <!-- Right Panel: Recipe Plan with Shopping List -->
            <Border Grid.Column="2" 
                    Padding="16,0,16,16">
                <Grid Background="#2d2d2d">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <!-- Tab Buttons -->
                    <StackPanel Grid.Row="0" 
                                Orientation="Horizontal" 
                                Margin="0,0,0,8">
                        <Border x:Name="RecipePlanTab"
                                Background="{DynamicResource AccentBrush}"
                                Padding="16,6"
                                Cursor="Hand"
                                MouseLeftButtonDown="OnRecipePlanTabClick">
                            <TextBlock Text="Recipe Plan" 
                                       FontWeight="SemiBold"
                                       Foreground="#1a1a1a"/>
                        </Border>
                        <Border x:Name="MarketLogisticsTab"
                                Background="Transparent"
                                Padding="16,6"
                                Cursor="Hand"
                                MouseLeftButtonDown="OnMarketLogisticsTabClick">
                            <TextBlock Text="Market Logistics" 
                                       FontWeight="SemiBold"
                                       Foreground="{DynamicResource AccentBrush}"/>
                        </Border>
                    </StackPanel>

                    <!-- Recipe Plan Content -->
                    <Border Grid.Row="1"
                            x:Name="RecipePlanContent"
                            Background="#252525"
                            BorderBrush="{DynamicResource AccentBrush}"
                            BorderThickness="1"
                            CornerRadius="4">
                        <ScrollViewer VerticalScrollBarVisibility="Auto" Margin="1">
                            <StackPanel x:Name="RecipePlanPanel" Margin="0,0,0,8">
                                <!-- Recipe cards populated dynamically -->
                            </StackPanel>
                        </ScrollViewer>
                    </Border>

                    <!-- Market Logistics Content (initially hidden) -->
                    <Border Grid.Row="1"
                            x:Name="MarketLogisticsContent"
                            Background="#252525"
                            BorderBrush="{DynamicResource AccentBrush}"
                            BorderThickness="1"
                            CornerRadius="4"
                            Visibility="Collapsed">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>

                            <!-- Filter Controls -->
                            <Border Grid.Row="0" 
                                    Background="#252525"
                                    CornerRadius="4"
                                    Padding="8"
                                    Margin="0,0,0,8">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="6" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="12" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="6" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="12" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="12" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="8" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0"
                                               Text="Sort:"
                                               VerticalAlignment="Center"
                                               Foreground="Gray"/>

                                    <ComboBox Grid.Column="2"
                                              x:Name="MarketSortCombo"
                                              SelectedIndex="0"
                                              SelectionChanged="OnMarketSortChanged"
                                              MinWidth="120"
                                              helpers:ComboBoxAutoWidthBehavior.EnableAutoWidth="True">
                                        <ComboBoxItem Content="By Recommended" />
                                        <ComboBoxItem Content="Alphabetical" />
                                    </ComboBox>

                                    <TextBlock Grid.Column="4"
                                               Text="Mode:"
                                               VerticalAlignment="Center"
                                               Foreground="Gray"/>

                                    <ComboBox Grid.Column="6"
                                              x:Name="MarketModeCombo"
                                              SelectedIndex="0"
                                              SelectionChanged="OnMarketModeChanged"
                                              MinWidth="140"
                                              ToolTip="Minimize Total Cost: Only buy what is needed. Maximize Value: Best price per unit, good for frequent crafts."
                                              helpers:ComboBoxAutoWidthBehavior.EnableAutoWidth="True">
                                        <ComboBoxItem Content="Minimize Total Cost" ToolTip="Only buy what is needed to complete a craft." />
                                        <ComboBoxItem Content="Maximize Value" ToolTip="Best price per unit. Good for frequent crafts." />
                                    </ComboBox>

                                    <CheckBox Grid.Column="8"
                                              x:Name="SearchAllNACheck"
                                              Content="Search all NA DCs"
                                              VerticalAlignment="Center"
                                              Foreground="LightGray"
                                              ToolTip="Search all North American Data Centers for potential savings via DC Travel."/>

                                    <ui:Button Grid.Column="10"
                                               x:Name="ViewMarketStatusButton"
                                               Content="View Status"
                                               Appearance="Secondary"
                                               Click="OnViewMarketStatus"
                                               IsEnabled="False"
                                               ToolTip="View real-time market data population status"/>

                                    <ui:Button Grid.Column="12"
                                               x:Name="RefreshMarketButton"
                                               Content="Refresh Market Data"
                                               Appearance="Secondary"
                                               Click="OnRefreshMarketData"
                                               IsEnabled="False"
                                               helpers:ButtonAutoShrinkBehavior.EnableAutoShrink="True"/>
                                </Grid>
                            </Border>

                            <!-- Craft vs Buy Analysis (Collapsible) -->
                            <Expander Grid.Row="1"
                                      x:Name="CraftVsBuyExpander"
                                      Background="#2d3a2d"
                                      Margin="0,0,0,8"
                                      IsExpanded="False"
                                      Visibility="Collapsed">
                                <Expander.Header>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="ðŸ“Š Craft vs Buy Analysis" 
                                                   FontWeight="SemiBold"
                                                   Foreground="#90EE90"/>
                                        <TextBlock x:Name="CraftVsBuySummaryText"
                                                   Text="" 
                                                   Margin="12,0,0,0"
                                                   Foreground="LightGray"
                                                   VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Expander.Header>
                                <Border Background="#252525"
                                        Padding="12">
                                    <StackPanel x:Name="CraftVsBuyContent">
                                        <!-- Analysis content added dynamically -->
                                    </StackPanel>
                                </Border>
                            </Expander>

                            <!-- Purchase Summary (Collapsible) -->
                            <Expander Grid.Row="2"
                                      x:Name="MarketSummaryExpander"
                                      Background="#2d4a3e"
                                      Margin="0,0,0,8"
                                      IsExpanded="True"
                                      Visibility="Collapsed">
                                <Expander.Header>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="ðŸ“¦ Purchase Summary" 
                                                   FontWeight="SemiBold"
                                                   Foreground="#90EE90"/>
                                        <TextBlock x:Name="MarketSummaryHeaderText"
                                                   Text="" 
                                                   Margin="12,0,0,0"
                                                   Foreground="LightGray"
                                                   VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Expander.Header>
                                <Border Background="#252525"
                                        Padding="12">
                                    <StackPanel x:Name="MarketSummaryContent" />
                                </Border>
                            </Expander>

                            <!-- Market Cards -->
                            <Border Grid.Row="3"
                                    Background="#2d2d2d"
                                    CornerRadius="4"
                                    Padding="8">
                                <ScrollViewer>
                                    <StackPanel x:Name="MarketCards">
                                        <!-- Market cards will be added dynamically -->
                                    </StackPanel>
                                </ScrollViewer>
                            </Border>
                        </Grid>
                    </Border>
                </Grid>
            </Border>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="2" 
                Background="#1a1a1a"
                BorderBrush="{DynamicResource AccentBrush}"
                BorderThickness="0,1,0,0"
                Padding="12,4">
            <TextBox x:Name="StatusLabel" 
                     Text="Ready"
                     Foreground="{DynamicResource AccentBrush}"
                     Background="Transparent"
                     BorderThickness="0"
                     IsReadOnly="True"
                     IsReadOnlyCaretVisible="True"/>
        </Border>
    </Grid>
</Window>
